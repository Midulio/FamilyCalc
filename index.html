<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400..800&family=Fredoka:wght@300..700&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet"/>
    <link rel="icon" type="image/png" href="src/logo.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FamilyCalc</title>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>

    <nav class="navbar">
        <div class="container-fluid d-flex align-items-center justify-content-between">
            <button class="btn btn-primary menu" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions"><img src="src/list.svg"></button>
            <div class="offcanvas offcanvas-start interiorMenu" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">
            <div class="offcanvas-header">
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body interiorMenu">
                <div class="explorar"> <h4>EXPLORAR</h4>
                    <a href="views/casas/index_casa.php"><img src="src/users.svg">Personas</a>
                    <a href="views/Impuestos_valores/imp_val.html"><img src="src/percent.svg">Valores</a>
                    <a href="views/movimientos/index_movimientos.php"><img src="src/receipt.svg">Resumen de gastos</a>
                    <a href="#"><img src="src/chart-line.svg">Estad√≠sticas de gastos</a>
                </div>
                <div class="container-fluid d-flex justify-content-between contactos-box position-absolute bottom-0 start-50 translate-middle-x">
                    <a class="contactos" href="#"><img class="position-absolute top-50 start-50 translate-middle" src="src/facebook-logo.svg"></a>
                    <a class="contactos" href="#"><img class="position-absolute top-50 start-50 translate-middle" src="src/instagram-logo.svg"></a>
                    <a class="contactos" href="#"><img class="position-absolute top-50 start-50 translate-middle" src="src/envelope.svg"></a>
                    <a class="contactos" href="#"><img class="position-absolute top-50 start-50 translate-middle" src="src/phone.svg"></a>
                </div>
            </div>
            </div>
            <a href="index.html" class="logo"><h1 class="mb-1 fs-2"><span class="family">Family</span><span class="calc">Calc</span></h1></a>
            <div>
                <a href="views/chatbot/chatbot.html" class="btn menu" type="button"><img src="src/robot.svg"></a>
                <div id="bot-tooltip">
                    üëã Haz clic AQU√ç para ABRIR el CHAT con el BOT ü§ñ
                </div>
                <a href="views/iniciarSesion/iniciarSesion.html" class="btn menu" type="button"><img src="src/user-circle.svg"></a>
            </div>
        </div>
    </nav>
    <section class="container-sm">
        <a href="views/movimientos/index_movimientos.php" class="animacionHover">
            <div class="gastos position-relative">
                <div class="gastosTitulo position-relative">
                    <h2> Gasto total </h2>
                    <h3 class="position-absolute top-50 end-0 translate-middle-y">Resumen de gastos</h3>
                </div>
                <div class="numeroGastos sco mx-auto">
                    <p id="totalImporte"><span>ARS</span></p>
                </div>
                <div class="position-absolute resumenGastos scrollcontainer text-center">

                </div>
            </div>
        </a>
            <div class="row text-center justify-content-center mb-4">
            <div class="btnChicos col-6 col-sm-4 mb-3">
                <a href="views/casas/index_casa.php" class="btnChicos animacionHover" id="casas"><img src="src/housewhite.svg"></a>
                <p>Casa/s</p>
            </div>

            <div class="btnChicos col-6 col-sm-4 mb-3">
                <a href="" class="btnChicos animacionHover" id="estadisticas"><img src="src/chart-barwhite.svg"></a>
                <p>Estad√≠sticas de gastos</p>
            </div>

            <div class="btnChicos col-6 col-sm-4 mb-3">
                <a href="views/Impuestos_valores/imp_val.html" class="btnChicos animacionHover" id="impuestos"><img src="src/currency-dollar-simplewhite.svg"></a>
                <p>Valores</p>
            </div>
        </div>
    </div>
    </section>
    <script>
        window.addEventListener("DOMContentLoaded", () => {  // Espera a que el DOM cargue completamente antes de ejecutar el script

  const tooltip = document.getElementById("bot-tooltip");  // Obtiene el elemento del tooltip por su ID

  // Cantidad m√°xima de veces que se mostrar√°
  const maxShows = 3;  // Define el l√≠mite de veces que el tooltip puede aparecer

  // Obtener valores de localStorage
  let shows = localStorage.getItem("botTooltipShows") || 0;  // Recupera cu√°ntas veces ya se mostr√≥ el tooltip (si no existe, arranca en 0)

  let lastShown = localStorage.getItem("botTooltipLastShown");  // Recupera la √∫ltima fecha en la que se mostr√≥ el tooltip

  const today = new Date().toDateString();  // Obtiene la fecha de hoy en formato de texto (ej: "Fri Sep 19 2025")

  // Verificar si ya se mostr√≥ demasiadas veces o si ya se mostr√≥ hoy
  if (shows < maxShows && lastShown !== today) {  // Condici√≥n: solo mostrar si a√∫n no alcanz√≥ el l√≠mite y no se mostr√≥ hoy

    // Mostrar tooltip
    tooltip.style.display = "block";  // Cambia el estilo a "block" para hacerlo visible

    // Guardar en localStorage
    localStorage.setItem("botTooltipShows", ++shows);  // Incrementa el contador y lo guarda en localStorage

    localStorage.setItem("botTooltipLastShown", today);  // Guarda la fecha actual para que no vuelva a mostrarse hoy

    // Ocultar despu√©s de 5 segundos
    setTimeout(() => {  // Inicia un temporizador de 5 segundos
      tooltip.style.display = "none";  // Cambia el estilo a "none" para ocultar el tooltip
    }, 5000);  // Define el tiempo de espera de 5000 milisegundos (5 segundos)
  }
});

// Hace una petici√≥n HTTP al archivo PHP que devuelve el total de importes
fetch('views/movimientos/total_importe.php')
  // Cuando llega la respuesta, la convierte a texto (no JSON)
  .then(response => response.text())
  // Luego, con ese texto ya obtenido (el total), se ejecuta esta funci√≥n
  .then(data => {
    // Inserta el total dentro del elemento con id "totalImporte"
    // Mostrando el valor con el prefijo "$" y el sufijo "ARS"
    document.getElementById('totalImporte').innerHTML = '$' + data + '<span>ARS</span>';
  });


// Hace otra petici√≥n HTTP al archivo PHP que devuelve un resumen de gastos
fetch('views/movimientos/resumen_gastos.php')
  // Convierte la respuesta en formato JSON (porque el PHP devuelve un array u objeto)
  .then(response => response.json())
  // Usa los datos obtenidos del JSON
  .then(data => {
    // Selecciona el contenedor donde se mostrar√° el resumen de gastos
    const resumenContainer = document.querySelector('.resumenGastos');
    // Limpia cualquier contenido anterior dentro del contenedor
    resumenContainer.innerHTML = '';

    // Diccionario que asocia cada categor√≠a con un √≠cono correspondiente
    const iconos = {
      "Entretenimiento": "src/popcorn.svg",
      "Indumentaria": "src/bag.svg",
      "Salud": "src/first-aid.svg",
      "Videojuegos o Suscripciones": "src/game-controller.svg",
      "Viajes": "src/airplane.svg",
      "Cuentas Bancarias": "src/bank2.svg",
      "Regalos": "src/gift.svg"
    };

    // Si el arreglo `data` tiene elementos (es decir, hay gastos registrados)
    if (data.length > 0) {
      // Calcula el total general de todos los importes para usarlo en porcentajes
      const totalGeneral = data.reduce((acc, item) => {
        // Convierte el texto del total (que puede tener puntos o comas) a n√∫mero flotante
        return acc + parseFloat(item.total.replace('.', '').replace(',', '.'));
      }, 0);

      // Recorre cada elemento del resumen de gastos
      data.forEach(item => {
        // Crea un contenedor (div) para cada √≠tem del resumen
        const div = document.createElement('div');
        // Le agrega clases y estilos b√°sicos
        div.classList.add('resumen-item');
        div.style.display = 'flex';
        div.style.gap = '10px';
        div.style.marginBottom = '20px';

        // Crea un elemento <img> para mostrar el √≠cono de la categor√≠a
        const img = document.createElement('img');
        // Usa el √≠cono correspondiente al servicio, o uno gen√©rico si no existe
        img.src = iconos[item.servicio] || "src/other.svg";
        img.alt = item.servicio; // texto alternativo
        // Aplica estilos de tama√±o y margen
        img.style.width = '60px';
        img.style.height = '60px';
        img.style.marginLeft = '.1rem';
        img.style.marginTop = '.2rem';

        // Crea un elemento <span> para mostrar el importe del gasto
        const texto = document.createElement('span');
        // Calcula el porcentaje que representa este gasto del total general
        const porcentaje = ((parseFloat(item.total.replace('.', '').replace(',', '.')) / totalGeneral) * 100).toFixed(1);
        // Inserta el texto con formato ‚Äî muestra el total en pesos
        texto.innerHTML = `<span class="pos-img mx-4 mx-lg-5 mt-md-2">$${item.total}</span>`;

        // Agrega la imagen y el texto al contenedor del √≠tem
        div.appendChild(img);
        div.appendChild(texto);
        // Y finalmente agrega el √≠tem al contenedor principal del resumen
        resumenContainer.appendChild(div);
      });

    } else {
      // Si no hay datos, muestra un mensaje indicando que no hay movimientos registrados
      resumenContainer.innerHTML = '<p class="text-muted mx-auto my-3">No hay movimientos registrados.</p>';
    }
  })
  // Si ocurre un error en la petici√≥n (por ejemplo, el PHP no responde)
  .catch(error => {
    // Muestra el error en la consola para depuraci√≥n
    console.error('Error al cargar el resumen de gastos:', error);
  });
    </script>
</body>
</html>