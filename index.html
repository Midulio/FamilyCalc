<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400..800&family=Fredoka:wght@300..700&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet"/>
    <link rel="icon" type="image/png" href="src/logo.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FamilyCalc</title>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>

    <nav class="navbar">
        <div class="container-fluid d-flex align-items-center justify-content-between">
            <button class="btn btn-primary menu" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions"><img src="src/list.svg"></button>
            <div class="offcanvas offcanvas-start interiorMenu" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">
            <div class="offcanvas-header">
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body interiorMenu">
                <div class="explorar"> <h4>EXPLORAR</h4>
                    <a href="views/casas/index_casa.php"><img src="src/users.svg">Personas</a>
                    <a href="views/Impuestos_valores/imp_val.html"><img src="src/percent.svg">Valores</a>
                    <a href="views/movimientos/index_movimientos.php"><img src="src/receipt.svg">Resumen de gastos</a>
                    <a href="#"><img src="src/chart-line.svg">Estad칤sticas de gastos</a>
                </div>
                <div class="container-fluid d-flex justify-content-between contactos-box position-absolute bottom-0 start-50 translate-middle-x">
                    <a class="contactos" href="#"><img class="position-absolute top-50 start-50 translate-middle" src="src/facebook-logo.svg"></a>
                    <a class="contactos" href="#"><img class="position-absolute top-50 start-50 translate-middle" src="src/instagram-logo.svg"></a>
                    <a class="contactos" href="#"><img class="position-absolute top-50 start-50 translate-middle" src="src/envelope.svg"></a>
                    <a class="contactos" href="#"><img class="position-absolute top-50 start-50 translate-middle" src="src/phone.svg"></a>
                </div>
            </div>
            </div>
            <a href="index.html" class="logo"><h1 class="mb-1 fs-2"><span class="family">Family</span><span class="calc">Calc</span></h1></a>
            <div>
                <a href="views/chatbot/chatbot.html" class="btn menu" type="button"><img src="src/robot.svg"></a>
                <div id="bot-tooltip">
                    游녦 Haz clic AQU칈 para ABRIR el CHAT con el BOT 游뱄
                </div>
                <a href="views/iniciarSesion/iniciarSesion.html" class="btn menu" type="button"><img src="src/user-circle.svg"></a>
            </div>
        </div>
    </nav>
    <section class="container-sm">
        <a href="views/movimientos/index_movimientos.php" class="animacionHover">
            <div class="gastos position-relative">
                <div class="gastosTitulo position-relative">
                    <h2> Gasto total </h2>
                    <h3 class="position-absolute top-50 end-0 translate-middle-y">Resumen de gastos</h3>
                </div>
                <div class="numeroGastos sco">
                    <p id="totalImporte"><span>ARS</span></p>
                </div>
                <div class="position-absolute resumenGastos scrollcontainer">

                </div>
            </div>
        </a>
            <div class="row text-center justify-content-center mb-4">
            <div class="btnChicos col-6 col-sm-4 mb-3">
                <a href="views/casas/index_casa.php" class="btnChicos animacionHover" id="casas"><img src="src/housewhite.svg"></a>
                <p>Casa/s</p>
            </div>

            <div class="btnChicos col-6 col-sm-4 mb-3">
                <a href="" class="btnChicos animacionHover" id="estadisticas"><img src="src/chart-barwhite.svg"></a>
                <p>Estad칤sticas de gastos</p>
            </div>

            <div class="btnChicos col-6 col-sm-4 mb-3">
                <a href="views/Impuestos_valores/imp_val.html" class="btnChicos animacionHover" id="impuestos"><img src="src/currency-dollar-simplewhite.svg"></a>
                <p>Valores</p>
            </div>
        </div>
    </div>
    </section>
    <script>
        window.addEventListener("DOMContentLoaded", () => {  // Espera a que el DOM cargue completamente antes de ejecutar el script

  const tooltip = document.getElementById("bot-tooltip");  // Obtiene el elemento del tooltip por su ID

  // Cantidad m치xima de veces que se mostrar치
  const maxShows = 3;  // Define el l칤mite de veces que el tooltip puede aparecer

  // Obtener valores de localStorage
  let shows = localStorage.getItem("botTooltipShows") || 0;  // Recupera cu치ntas veces ya se mostr칩 el tooltip (si no existe, arranca en 0)

  let lastShown = localStorage.getItem("botTooltipLastShown");  // Recupera la 칰ltima fecha en la que se mostr칩 el tooltip

  const today = new Date().toDateString();  // Obtiene la fecha de hoy en formato de texto (ej: "Fri Sep 19 2025")

  // Verificar si ya se mostr칩 demasiadas veces o si ya se mostr칩 hoy
  if (shows < maxShows && lastShown !== today) {  // Condici칩n: solo mostrar si a칰n no alcanz칩 el l칤mite y no se mostr칩 hoy

    // Mostrar tooltip
    tooltip.style.display = "block";  // Cambia el estilo a "block" para hacerlo visible

    // Guardar en localStorage
    localStorage.setItem("botTooltipShows", ++shows);  // Incrementa el contador y lo guarda en localStorage

    localStorage.setItem("botTooltipLastShown", today);  // Guarda la fecha actual para que no vuelva a mostrarse hoy

    // Ocultar despu칠s de 5 segundos
    setTimeout(() => {  // Inicia un temporizador de 5 segundos
      tooltip.style.display = "none";  // Cambia el estilo a "none" para ocultar el tooltip
    }, 5000);  // Define el tiempo de espera de 5000 milisegundos (5 segundos)
  }
});

fetch('views/movimientos/total_importe.php')
.then(response => response.text())
.then(data => {
    document.getElementById('totalImporte').innerHTML = '$' + data + '<span>ARS</span>';
});

fetch('views/movimientos/resumen_gastos.php')
  .then(response => response.json())
  .then(data => {
    const resumenContainer = document.querySelector('.resumenGastos');
    resumenContainer.innerHTML = ''; // Limpiamos lo que hab칤a

    const iconos = {
      "Entretenimiento": "src/popcorn.svg",
      "Indumentaria": "src/bag.svg",
      "Salud": "src/first-aid.svg",
      "Videojuegos o Suscripciones": "src/game-controller.svg",
      "Viajes": "src/airplane.svg",
      "Cuentas Bancarias": "src/bank2.svg",
      "Regalos": "src/gift.svg"
    };

    if (data.length > 0) {
      // Calcular total general para mostrar porcentaje opcional
      const totalGeneral = data.reduce((acc, item) => {
        return acc + parseFloat(item.total.replace('.', '').replace(',', '.'));
      }, 0);

      data.forEach(item => {
        const div = document.createElement('div');
        div.classList.add('resumen-item');
        div.style.display = 'flex';
        div.style.alignItems = 'center';
        div.style.gap = '10px';
        div.style.marginBottom = '20px';

        const img = document.createElement('img');
        img.src = iconos[item.servicio] || "src/other.svg";
        img.alt = item.servicio;
        img.style.width = '55px';
        img.style.height = '55px';
        img.style.marginLeft = '.1rem';

        const texto = document.createElement('span');
        const porcentaje = ((parseFloat(item.total.replace('.').replace(',', '.')) / totalGeneral) * 100).toFixed(1);
        texto.innerHTML = `<span class="pos-img">$${item.total}</span>`;

        div.appendChild(img);
        div.appendChild(texto);
        resumenContainer.appendChild(div);
      });
    } else {
      resumenContainer.innerHTML = '<p class="text-muted">No hay movimientos registrados.</p>';
    }
  })
  .catch(error => {
    console.error('Error al cargar el resumen de gastos:', error);
  });
    </script>
</body>
</html>